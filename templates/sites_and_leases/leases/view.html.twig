{% extends 'sites_and_leases/layout.html.twig' %}

{% block title %}View Lease{% endblock %}

{% block breadcrumbs %}
    <h3 class="kt-subheader__title">View Lease</h3>
{% endblock %}

{% block stylesheets %}
    <link href="{{ asset('assets/vendors/custom/datatables/datatables.bundle.css') }}" rel="stylesheet" type="text/css" />
    <style>
        .dataTables_filter{
            display: none!important;
        }
        div.dataTables_wrapper div.dataTables_info {
            white-space: pre-wrap!important;
        }
    </style>
{% endblock %}

{% block body %}
    <div class="kt-container  kt-grid__item kt-grid__item--fluid">
        <div class="kt-portlet">
            <div class="kt-portlet__head kt-portlet__head--lg">
                <div class="kt-portlet__head-label">
                    <h3 class="kt-portlet__head-title">View Lease</h3>
                </div>
                <div class="kt-portlet__head-toolbar">
                    <div class="kt-portlet__head-wrapper">
                        <div class="kt-portlet__head-actions">
                            {% if userPermission.edit is defined and userPermission.edit == true %}
                                <a href="{{ path('lease_edit', {id:lease.id}) }}" class="btn btn-sm btn-brand btn-elevate btn-icon-sm">
                                    <i class="la la-edit"></i>
                                    Edit Lease
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="kt-portlet__body">
                <div class="kt-section kt-section--first">
                    <h3 class="kt-section__title text-center">
                        {% if (userPermissionSite.view is defined and userPermissionSite.view == true) or (userPermissionSite.edit is defined and userPermissionSite.edit == true) %}
                            <a href="{{ path('lease_edit', {id:lease.id}) }}">
                                {{ lease.site.number }} - {{ lease.site.name }}
                            </a>
                        {% else %}
                            {{ lease.site.number }} - {{ lease.site.name }}
                        {% endif %}
                        (Landlord:
                            {% if userPermissionLandlord.view is defined and userPermissionLandlord.view == true %}
                                <a href="{{ path('landlord_view', {id:lease.landlord.id}) }}">
                                    {{ lease.landlord.name }}
                                </a>
                            {% else %}
                                {{ lease.landlord.name }}
                            {% endif %}
                        )
                    </h3>

                    <div class="form-group form-group-xs row">
                        <div class="col-sm-6 text-right">
                            <span class="form-control-plaintext">
                                Site Status:
                                <span class="kt-font-bolder">
                                    {{ lease.site.siteStatus.name is defined ? lease.site.siteStatus.name : '' }}
                                </span>
                            </span>
                        </div>
                        <div class="col-sm-6 text-left">
                            <span class="form-control-plaintext">
                                Managed By Agent:
                                <span class="kt-font-bolder">
                                    {{ lease.agentStatus == true ? 'Yes' : 'No' }}
                                </span>
                            </span>
                        </div>
                    </div>

                    <div class="form-group form-group-xs row">
                        <div class="col-sm-12">
                            <span class="form-control-plaintext text-center">
                                Site Address:
                                <span class="kt-font-bolder">
                                    {{ lease.site.address }}
                                </span>
                            </span>
                        </div>
                    </div>

                    <div class="form-group form-group-xs row">
                        <div class="col-sm-12">
                            <div id="googleMap" style="width:100%;height:300px;"></div>
                        </div>
                    </div>
                </div>

                {% if userPermissionIssue.view is defined and userPermissionIssue.view == true %}
                    <div class="kt-section mt-2">
                        <h3 class="kt-section__title">Site Issue</h3>
                        <div class="kt-section__content">
                            <form class="kt-form kt-form--fit">
                                <div class="row kt-margin-b-20">
                                    <div class="col-sm-6 kt-margin-b-10-tablet-and-mobile">
                                        <label>Type:</label>
                                        <select class="form-control kt-input" data-col-index="1">
                                            <option value="">Select a Issue Type</option>
                                            {% for issueType in issueTypes %}
                                                <option value="{{ issueType.name }}">{{ issueType.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-sm-6 kt-margin-b-10-tablet-and-mobile">
                                        <label>Status:</label>
                                        <select class="form-control kt-input" data-col-index="3">
                                            <option value="Open" selected>Open</option>
                                            <option value="Close">Close</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12 text-right">
                                        <button class="btn btn-primary btn-brand--icon" id="kt_search">
                                            <span><i class="la la-search"></i> Search</span>
                                        </button>
                                        <button class="btn btn-secondary btn-secondary--icon" id="kt_reset">
                                            <span><i class="la la-close"></i>Reset</span>
                                        </button>
                                    </div>
                                </div>
                            </form>
                            <div class="kt-separator kt-separator--border-dashed kt-separator--space-md"></div>
                            <table class="table table-striped- table-bordered table-hover table-checkable responsive no-wrap" id="tableIssue">
                                <thead>
                                <tr>
                                    <th>Date logged</th>
                                    <th>Type</th>
                                    <th>Details</th>
                                    <th>Status</th>
                                    <th class="text-right">Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% if issues is defined and issues is not empty %}
                                    {% for issue in issues %}
                                        <tr data-id="{{ issue.id }}">
                                            <td>{{ issue.logged|date('d M Y H:i') }}</td>
                                            <td>{{ (issue.type.name is defined) ? issue.type.name : issue.type }}</td>
                                            <td>{{ issue.details }}</td>
                                            <td>{{ (issue.status == true) ? "Open" : "Close" }}</td>
                                            <td class="text-right">
                                                {% if (userPermissionIssue.view is defined and userPermissionIssue.view == true) or (userPermissionIssue.edit is defined and userPermissionIssue.edit == true) %}
                                                    <a href="{{ path('issue_edit', {id:issue.id}) }}" class="btn btn-sm btn-brand btn-icon-sm"><i class="la la-edit"></i></a>
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                {% endif %}

                <div class="row mt-2">
                    <div class="col-md-5">
                        <div class="kt-section">
                            <h3 class="kt-section__title">Lease Details</h3>
                            <div class="kt-section__content">
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-12">
                                        <span class="form-control-plaintext">
                                            Start Date:
                                            <span class="kt-font-bolder">
                                                {{ lease.startDate|date('d M Y') }}
                                            </span>
                                        </span>
                                    </div>
                                    <div class="col-sm-12">
                                        <span class="form-control-plaintext">
                                            End Date:
                                            <span class="kt-font-bolder">
                                                {{ lease.endDate|date('d M Y') }}
                                            </span>
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-12">
                                        <span class="form-control-plaintext">
                                            Lease Renewal Option:
                                            <span class="kt-font-bolder">
                                                {{ (lease.renewalStatus == true) ? 'Yes' : 'No' }}
                                            </span>
                                        </span>
                                    </div>
                                    {% if lease.renewalStatus == true %}
                                        <div class="col-sm-12">
                                            <span class="form-control-plaintext">
                                                Lease Renewal Option Period:
                                                <span class="kt-font-bolder">
                                                    {{ lease.renewal }} {{ (lease.renewal == 1) ? 'month' : 'months' }}
                                                </span>
                                            </span>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-12">
                                        <span class="form-control-plaintext">
                                            Escalation:
                                            <span class="kt-font-bolder">
                                                {% if lease.annualEscalationType == 'cpi' %}
                                                    CPI plus {{ lease.annualEscalationCpi }}%
                                                {% else %}
                                                    Fixed {{ lease.annualEscalation }}%
                                                {% endif %}
                                            </span>
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-12">
                                    <span class="form-control-plaintext">
                                        Electricity:
                                        <span class="kt-font-bolder">
                                            {{ lease.electricityType.name }}
                                        </span>
                                    </span>
                                    </div>
                                    {% if lease.electricityType.id == 3 %}
                                        <div class="col-sm-12">
                                            <span class="form-control-plaintext">
                                                Electricity Amount:
                                                <span class="kt-font-bolder">
                                                    {{ currencySymbol }} {{ lease.electricityFixed }}
                                                </span>
                                            </span>
                                        </div>
                                    {% endif %}
                                </div>

                                {% set valueWater = 'No' %}
                                {% set valueSewer = 'No' %}
                                {% set valueRates = 'No' %}
                                {% set valueRefuse = 'No' %}
                                {% if lease.otherUtilityCost is not empty %}
                                    {% for otherCost in lease.otherUtilityCost %}
                                        {% if otherCost.name == 'Water' %}
                                            {% set valueWater = 'Yes' %}
                                        {% elseif otherCost.name == 'Sewer' %}
                                            {% set valueSewer = 'Yes' %}
                                        {% elseif otherCost.name == 'Rates' %}
                                            {% set valueRates = 'Yes' %}
                                        {% elseif otherCost.name == 'Refuse' %}
                                            {% set valueRefuse = 'Yes' %}
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-12">
                                        <span class="form-control-plaintext">
                                            Water:
                                            <span class="kt-font-bolder">
                                                {{ valueWater }}
                                            </span>
                                        </span>
                                    </div>
                                    <div class="col-sm-12">
                                        <span class="form-control-plaintext">
                                            Sewer:
                                            <span class="kt-font-bolder">
                                                {{ valueSewer }}
                                            </span>
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-12">
                                        <span class="form-control-plaintext">
                                            Rates:
                                            <span class="kt-font-bolder">
                                                {{ valueRates }}
                                            </span>
                                        </span>
                                    </div>
                                    <div class="col-sm-12">
                                        <span class="form-control-plaintext">
                                            Refuse:
                                            <span class="kt-font-bolder">
                                                {{ valueRefuse }}
                                            </span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-7">
                        <div class="kt-section">
                            <h3 class="kt-section__title">Lease Commercials</h3>
                            <div class="kt-section__content">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="tableRentalCost">
                                        <thead>
                                        <tr>
                                            <th width="40%"></th>
                                            <th width="15%">Initial Rental</th>
                                            <th width="15%">Start Date</th>
                                            <th width="15%">Current Rental</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% set initialTotal = 0 %}
                                        {% set initialCurrentTotal = 0 %}
                                        {% for rentalCost in leaseRentalCosts %}
                                            {% if rentalCost.additional == false %}
                                                {% set currentAmount = rentalCost.amount %}
                                                {% if date(rentalCost.startDate) <= date() %}
                                                    {% set currentAmount = rentalCost.currentAmount %}
                                                    {% set initialTotal = initialTotal + rentalCost.amount|round(2) %}
                                                    {% set initialCurrentTotal = initialCurrentTotal + rentalCost.currentAmount %}
                                                {% endif %}

                                                <tr data-id="{{ rentalCost.id }}" data-initial="1">
                                                    <td data-category-id="{{ rentalCost.category.id }}">{{ rentalCost.category.name }}</td>
                                                    <td>{{ currencySymbol }} {{ rentalCost.amount }}</td>
                                                    <td>{{ rentalCost.startDate|date('d M Y') }}</td>
                                                    <td>{{ currencySymbol }} {{ currentAmount }}</td>
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                        <tr>
                                            <td class="font-weight-bold">INITIAL MONTHLY LEASE COST</td>
                                            <td class="font-weight-bold">{{ currencySymbol }} <span id="initialTotal">{{ initialTotal|round(2) }}</span></td>
                                            <td></td>
                                            <td class="font-weight-bold">{{ currencySymbol }} <span id="initialCurrentTotal">{{ initialCurrentTotal|round(2) }}</span></td>
                                        </tr>
                                        <tr>
                                            <td class="font-weight-bold">ADDITIONAL EQUIPMENT ADDENDUM</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        {% set monthlyTotal = initialTotal %}
                                        {% set monthlyCurrentTotal = initialCurrentTotal %}
                                        {% for rentalCost in leaseRentalCosts %}
                                            {% if rentalCost.additional == true %}
                                                {% set currentAmount = rentalCost.amount %}
                                                {% if date(rentalCost.startDate) <= date() %}
                                                    {% set currentAmount = rentalCost.currentAmount %}
                                                    {% set monthlyTotal = monthlyTotal + rentalCost.amount|round(2) %}
                                                    {% set monthlyCurrentTotal = monthlyCurrentTotal + rentalCost.currentAmount %}
                                                {% endif %}
                                                <tr data-id="{{ rentalCost.id }}">
                                                    <td data-category-id="{{ rentalCost.category.id }}">{{ rentalCost.category.name }}</td>
                                                    <td>{{ currencySymbol }} {{ rentalCost.amount }}</td>
                                                    <td>{{ rentalCost.startDate|date('d M Y') }}</td>
                                                    <td>{{ currencySymbol }} {{ currentAmount }}</td>
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                        <tr id="totalMonthlyRentalCostTR">
                                            <td class="font-weight-bold">TOTAL MONTHLY RENT COST</td>
                                            <td class="font-weight-bold">{{ currencySymbol }} <span id="monthlyTotal">{{ monthlyTotal|round(2) }}</td>
                                            <td class="font-weight-bold"></td>
                                            <td class="font-weight-bold">{{ currencySymbol }} <span id="monthlyCurrentTotal">{{ monthlyCurrentTotal|round(2) }}</span></td>
                                        </tr>
                                        {% if lease.electricityType.id == 3 %}
                                            <tr>
                                                <td>Electricity (Landlord - Fixed)</td>
                                                <td>{{ currencySymbol }} {{ lease.electricityFixed }}</td>
                                                <td>{{ lease.startDate|date('d M Y') }}</td>
                                                <td>{{ currencySymbol }} {{ lease.electricityFixed+((lease.electricityFixed*percentage)/100)|round(2) }}</td>
                                            </tr>
                                        {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="row mt-2">
                    <div class="col-12">
                        <div class="kt-section">
                            <h3 class="kt-section__title">Site Emergency Access Details</h3>
                            <h3 class="kt-section__title kt-section__title-sm">Emergency Access Details</h3>
                            <div class="kt-section__content">
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-12">
                                        <span class="form-control-plaintext">
                                            Hours of access:
                                            <span class="kt-font-bolder">
                                                {{ (lease.site.hoursOfAccess.name is defined) ? lease.site.hoursOfAccess.name : '' }}
                                            </span>
                                        </span>
                                    </div>
                                </div>
                                {% if lease.site.otherAccess is not empty %}
                                    <div class="form-group form-group-xs row">
                                        <div class="col-sm-12">
                                            <span class="form-control-plaintext">
                                                Other access information and procedures:
                                                <span class="kt-font-bolder">
                                                    {{ lease.site.otherAccess }}
                                                </span>
                                            </span>
                                        </div>
                                    </div>
                                {% endif %}
                                <h3 class="kt-section__title kt-section__title-sm">Emergency Access Contacts</h3>
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-12">
                                    <span class="form-control-plaintext">
                                        Primary Emergency Contact:
                                        <span class="kt-font-bolder">
                                            {% if lease.site.primaryEmergencyContact is defined and lease.site.primaryEmergencyContact is not empty %}
                                                {{ lease.site.primaryEmergencyContact.firstName }};
                                                {{ lease.site.primaryEmergencyContact.lastName }};
                                                {{ lease.site.primaryEmergencyContact.company }};
                                                <a href="tel: {{ lease.site.primaryEmergencyContact.mobile }}">{{ lease.site.primaryEmergencyContact.mobile }}</a>;
                                                <a href="mailto: {{ lease.site.primaryEmergencyContact.email }}">{{ lease.site.primaryEmergencyContact.email }}</a>.
                                            {% endif %}
                                        </span>
                                    </span>
                                    </div>
                                </div>
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-12">
                                    <span class="form-control-plaintext">
                                        Secondary Emergency Contact:
                                        <span class="kt-font-bolder">
                                            {% if lease.site.secondaryEmergencyContact is defined and lease.site.secondaryEmergencyContact is not empty %}
                                                {{ lease.site.secondaryEmergencyContact.firstName }};
                                                {{ lease.site.secondaryEmergencyContact.lastName }};
                                                {{ lease.site.secondaryEmergencyContact.company }};
                                                <a href="tel: {{ lease.site.secondaryEmergencyContact.mobile }}">{{ lease.site.secondaryEmergencyContact.mobile }}</a>;
                                                <a href="mailto: {{ lease.site.secondaryEmergencyContact.email }}">{{ lease.site.secondaryEmergencyContact.email }}</a>.
                                            {% endif %}
                                        </span>
                                    </span>
                                    </div>
                                </div>
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-12">
                                    <span class="form-control-plaintext">
                                        Last Updated:
                                        <span class="kt-font-bolder">
                                            {{ (lease.site.emergencyAccessUpdated is defined and lease.site.emergencyAccessUpdated is not empty) ? lease.site.emergencyAccessUpdated|date('d M Y') : '' }}
                                        </span>
                                    </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="kt-section">
                            <h3 class="kt-section__title">Site Inventory</h3>
                            <div class="kt-section__content">
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead>
                                        <tr>
                                            <th>Category</th>
                                            <th>Quantity</th>
                                            <th>Size (mm)</th>
                                            <th>Height (m)</th>
                                            <th>Weight (kg)</th>
                                            <th>Details</th>
                                            <th>Last Updated</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% if siteInventories is defined and siteInventories is not empty %}
                                            {% for siteInventory in siteInventories %}
                                                <tr>
                                                    <td>{{ siteInventory.category.name is defined ? siteInventory.category.name : '' }}</td>
                                                    <td>{{ siteInventory.quantity }}</td>
                                                    <td>{{ siteInventory.size }}</td>
                                                    <td>{{ siteInventory.height }}</td>
                                                    <td>{{ siteInventory.weight }}</td>
                                                    <td>{{ siteInventory.info }}</td>
                                                    <td>
                                                        {% if siteInventory.updated is not empty %}
                                                            {{ siteInventory.updated|date('d M Y H:i') }}
                                                        {% else %}
                                                            {{ lease.site.updated|date('d M Y H:i') }}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        {% else %}
                                            <tr class="text-center">
                                                <td colspan="7">Not found site inventory</td>
                                            </tr>
                                        {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="kt-section mt-2">
                    <h3 class="kt-section__title">Lease Supporting Documents</h3>
                    <div class="kt-section__content">
                        <div class="form-group form-group-xs row">
                            <div class="col-sm-12">
                                <span class="form-control-plaintext">
                                    Status Of Lease Documentation:
                                    <span class="kt-font-bolder">
                                        {{ (lease.documentStatus.name is defined) ? lease.documentStatus.name : '' }}
                                    </span>
                                </span>
                            </div>
                        </div>
                        <div class="document-items">
                            {% if leaseDocuments is defined and leaseDocuments is not empty %}
                                <div class="form-group row">
                                {% for leaseDocument in leaseDocuments %}
                                    <div class="col-xl-3 col-md-4 col-sm-6 col-12 mt-2">
                                        <div class="upload-file-container uploaded bg-light">
                                            <a href="{{ leaseDocument.document }}" target="_blank">
                                                <div class="upload-file-container__file-uploaded">
                                                    <span class="text-dark font-weight-bold">
                                                        {{ (leaseDocument.type.name is defined) ? leaseDocument.type.name : '' }}
                                                    </span>
                                                    <span class="upload-file-container__file-name">
                                                       {{ (leaseDocument.name is defined and leaseDocument.name is not empty) ? leaseDocument.name : '' }}
                                                    </span>
                                                    <span class="upload-file-container__file-date">
                                                        {{ (leaseDocument.created is defined and leaseDocument.created is not empty) ? leaseDocument.created|date('d M Y') : '' }}
                                                    </span>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="kt-section mt-2">
                    <h3 class="kt-section__title">Lease Notes</h3>
                    <div class="kt-section__content">
                        {% if leaseNotes is not empty %}
                            {% for note in leaseNotes %}
                                {% if loop.index0 != 0 %}
                                    <div class="kt-separator kt-separator--border-dashed kt-separator--space-sm"></div>
                                {% endif %}
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-12">
                                    <span class="form-control-plaintext">
                                        Details:<br>
                                        <span class="kt-font-bolder" style="white-space: pre-line;">{{ note.text|raw }}</span>
                                    </span>
                                    </div>
                                    <div class="col-sm-12">
                                    <span class="form-control-plaintext">
                                        Date Updated:
                                        <span class="kt-font-bolder">{{ note.updated|date('d M Y H:i') }}</span>
                                    </span>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-left">Not found lease notes...</p>
                        {% endif %}
                    </div>
                </div>

                <div class="kt-section kt-section--last">
                    <h3 class="kt-section__title">Previous Lease Details</h3>
                    <div class="kt-section__content">
                        {% if previousLeases is not empty %}
                            {% for previousLease in previousLeases %}
                                {% if loop.index0 != 0 %}
                                    <div class="kt-separator kt-separator--space-md kt-separator--fit kt-separator--border-solid"></div>
                                {% endif %}
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-6">
                                        <span class="form-control-plaintext">
                                            Start Date:
                                            <span class="kt-font-bolder">
                                                {{ previousLease.startDate|date('d M Y') }}
                                            </span>
                                        </span>
                                    </div>
                                    <div class="col-sm-6">
                                        <span class="form-control-plaintext">
                                            End Date:
                                            <span class="kt-font-bolder">
                                                {{ previousLease.endDate|date('d M Y') }}
                                            </span>
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-6">
                                        <span class="form-control-plaintext">
                                            Lease Renewal Option:
                                            <span class="kt-font-bolder">
                                                {{ (previousLease.renewalStatus == true) ? 'Yes' : 'No' }}
                                            </span>
                                        </span>
                                    </div>
                                    {% if previousLease.renewalStatus == true %}
                                        <div class="col-sm-6">
                                            <span class="form-control-plaintext">
                                                Lease Renewal Option Period:
                                                <span class="kt-font-bolder">
                                                    {{ previousLease.renewal }} {{ (previousLease.renewal == 1) ? 'month' : 'months' }}
                                                </span>
                                            </span>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-12">
                                        <span class="form-control-plaintext">
                                            Escalation:
                                            <span class="kt-font-bolder">
                                                {% if previousLease.annualEscalationType == 'cpi' %}
                                                    CPI plus {{ previousLease.annualEscalationCpi }}%
                                                {% else %}
                                                    Fixed {{ previousLease.annualEscalation }}%
                                                {% endif %}
                                            </span>
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-6">
                                        <span class="form-control-plaintext">
                                            Electricity:
                                            <span class="kt-font-bolder">
                                                {{ previousLease.electricityType.name }}
                                            </span>
                                        </span>
                                    </div>
                                    {% if previousLease.electricityType.id == 3 %}
                                        <div class="col-sm-6">
                                            <span class="form-control-plaintext">
                                                Electricity Amount:
                                                <span class="kt-font-bolder">
                                                    R {{ previousLease.electricityFixed }}
                                                </span>
                                            </span>
                                        </div>
                                    {% endif %}
                                </div>

                                {% set valueWater = 'No' %}
                                {% set valueSewer = 'No' %}
                                {% set valueRates = 'No' %}
                                {% set valueRefuse = 'No' %}
                                {% if previousLease.otherUtilityCost is not empty %}
                                    {% for otherCost in previousLease.otherUtilityCost %}
                                        {% if otherCost.name == 'Water' %}
                                            {% set valueWater = 'Yes' %}
                                        {% elseif otherCost.name == 'Sewer' %}
                                            {% set valueSewer = 'Yes' %}
                                        {% elseif otherCost.name == 'Rates' %}
                                            {% set valueRates = 'Yes' %}
                                        {% elseif otherCost.name == 'Refuse' %}
                                            {% set valueRefuse = 'Yes' %}
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-6">
                                        <span class="form-control-plaintext">
                                            Water:
                                            <span class="kt-font-bolder">
                                                {{ valueWater }}
                                            </span>
                                        </span>
                                    </div>
                                    <div class="col-sm-6">
                                        <span class="form-control-plaintext">
                                            Sewer:
                                            <span class="kt-font-bolder">
                                                {{ valueSewer }}
                                            </span>
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-6">
                                        <span class="form-control-plaintext">
                                            Rates:
                                            <span class="kt-font-bolder">
                                                {{ valueRates }}
                                            </span>
                                        </span>
                                    </div>
                                    <div class="col-sm-6">
                                        <span class="form-control-plaintext">
                                            Refuse:
                                            <span class="kt-font-bolder">
                                                {{ valueRefuse }}
                                            </span>
                                        </span>
                                    </div>
                                </div>
                                <h3 class="kt-section__title kt-section__title-sm mb-0">Lease Supporting Documents</h3>
                                <div class="form-group form-group-xs row">
                                    <div class="col-sm-12">
                                        <span class="form-control-plaintext">
                                            Status Of Lease Documentation:
                                            <span class="kt-font-bolder">
                                                {{ (previousLease.documentStatus.name is defined) ? previousLease.documentStatus.name : '' }}
                                            </span>
                                        </span>
                                    </div>
                                </div>
                                <div class="document-items">
                                    {% if previousLease.leaseDocuments is defined and previousLease.leaseDocuments is not empty %}
                                        <div class="form-group row">
                                            {% for previousLeaseDocument in previousLease.leaseDocuments %}
                                                <div class="col-xl-3 col-md-4 col-sm-6 col-12 mt-2">
                                                    <div class="upload-file-container uploaded bg-light">
                                                        <a href="{{ previousLeaseDocument.document }}" target="_blank">
                                                            <div class="upload-file-container__file-uploaded">
                                                                <span class="text-dark font-weight-bold">
                                                                    {{ (previousLeaseDocument.type.name is defined) ? previousLeaseDocument.type.name : '' }}
                                                                </span>
                                                                <span class="upload-file-container__file-name">
                                                                   {{ (previousLeaseDocument.name is defined and previousLeaseDocument.name is not empty) ? previousLeaseDocument.name : '' }}
                                                                </span>
                                                                <span class="upload-file-container__file-date">
                                                                    {{ (previousLeaseDocument.created is defined and previousLeaseDocument.created is not empty) ? previousLeaseDocument.created|date('d M Y') : '' }}
                                                                </span>
                                                            </div>
                                                        </a>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <h3 class="kt-section__title kt-section__title-sm mb-2">Lease Commercials</h3>
                                <div class="table-responsive">
                                    <table class="table table-bordered responsive">
                                        <tbody>
                                        <tr>
                                            <td class="font-weight-bold">FROM</td>
                                            {% for headerFrom in previousLease.commercials.from %}
                                                <td>{{ headerFrom|date('d M Y') }}</td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td class="font-weight-bold">TO</td>
                                            {% for headerTo in previousLease.commercials.to %}
                                                <td>{{ headerTo|date('d M Y') }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% for item in previousLease.commercials.items %}
                                            <tr>
                                                <td class="font-weight-bold" colspan="{{ item.skip }}">{{ item.name }}</td>
                                                {% for amount in item.amount %}
                                                    {% if amount is not null %}
                                                        <td>{{ currencySymbol }} {{ amount|round(2) }}</td>
                                                    {% endif %}
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}

                                        <tr>
                                            <td class="font-weight-bold">Total Monthly Rent</td>
                                            {% for totalMonthly in previousLease.commercials.totalMonthly %}
                                                <td class="font-weight-bold">{{ currencySymbol }} {{ totalMonthly|round(2) }}</td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td class="font-weight-bold">Total Annual Rent</td>
                                            {% for totalAnnual in previousLease.commercials.totalAnnual %}
                                                <td class="font-weight-bold">{{ currencySymbol }} {{ totalAnnual|round(2) }}</td>
                                            {% endfor %}
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                {% if userPermission.edit is defined and userPermission.edit == true %}
                                    <div class="form-group text-right mb-0">
                                        <a href="{{ path('lease_edit', {id:previousLease.id}) }}" class="btn btn-info">Edit Lease</a>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            <p class="text-left">Previous leases not found...</p>
                        {% endif %}
                    </div>
                </div>

            </div>
        </div>

    </div>

{% endblock %}

{% block javascripts %}
    <script src="{{ asset('assets/vendors/custom/datatables/datatables.bundle.js') }}" type="text/javascript"></script>

    <script src="{{ asset('assets/js/pages/lease_view.js') }}" type="text/javascript"></script>

    <script>
        var geocoder;
        var map;
        var address = '{{ lease.site.address }}';
        function initMap() {
            var map = new google.maps.Map(document.getElementById('googleMap'), {
                zoom: 15,
                center: {lat: -34.397, lng: 150.644}
            });
            geocoder = new google.maps.Geocoder();
            codeAddress(geocoder, map);
        }

        function codeAddress(geocoder, map) {
            geocoder.geocode({'address': address}, function(results, status) {
                if (status === 'OK') {
                    map.setCenter(results[0].geometry.location);
                    var marker = new google.maps.Marker({
                        map: map,
                        position: results[0].geometry.location
                    });
                }
            });
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCliFm7C1H1t_O5MFiN-SB3luq867neo4Y&libraries=places&callback=initMap" async defer></script>
{% endblock %}
