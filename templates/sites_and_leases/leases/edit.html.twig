{% extends 'sites_and_leases/layout.html.twig' %}

{% block title %}Edit Lease{% endblock %}

{% block breadcrumbs %}
    <h3 class="kt-subheader__title">Edit Lease</h3>
{% endblock %}

{% block stylesheets %}
    <link href="{{ asset('assets/vendors/general/bootstrap-datepicker/dist/css/bootstrap-datepicker3.css') }}" rel="stylesheet" type="text/css" />
    <link href="{{ asset('assets/vendors/general/select2/dist/css/select2.css') }}" rel="stylesheet" type="text/css" />
    <link href="{{ asset('assets/vendors/general/bootstrap-switch/dist/css/bootstrap3/bootstrap-switch.css') }}" rel="stylesheet" type="text/css" />
    <link href="{{ asset('assets/vendors/custom/datatables/datatables.bundle.css') }}" rel="stylesheet" type="text/css" />
    <style>
        .dataTables_filter{
            display: none!important;
        }
    </style>
{% endblock %}

{% block body %}
    <div class="kt-container  kt-grid__item kt-grid__item--fluid">
        <div class="kt-portlet kt-portlet--tabs">
            <div class="kt-portlet__head">
                <div class="kt-portlet__head-toolbar">
                    <ul class="nav nav-tabs nav-tabs-space-lg nav-tabs-line nav-tabs-bold nav-tabs-line-3x nav-tabs-line-brand" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" href="#leaseDetails" role="tab" aria-selected="true">
                                Details
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#leaseCommercials" role="tab" aria-selected="false">
                                Commercials
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#leaseDocuments" role="tab" aria-selected="false">
                                Documents
                            </a>
                        </li>
                        {% if userPermissionIssue.view is defined and userPermissionIssue.view == true %}
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#issueTab" role="tab" aria-selected="false">
                                    Issue
                                </a>
                            </li>
                        {% endif %}
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#siteInventoryAndEmergency" role="tab" aria-selected="false">
                                Site Inventory & Emergency
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#leasePrevious" role="tab" aria-selected="false">
                                Previous
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="kt-portlet__body">
                <div class="tab-content  kt-margin-t-20">
                    <!--Begin:: Tab Content-->
                    <div class="tab-pane active" id="leaseDetails" role="tabpanel">
                        <form class="kt-form" action="{{ path('lease_edit', {id:lease.id}) }}" method="post" id="formStep1">
                            <div class="kt-form__body">
                                <div class="kt-section kt-section--first">
                                    <div class="kt-section__body">
                                        <div class="row">
                                            <div class="col-sm-8">
                                                <h3 class="kt-section__title">Lease Details</h3>
                                            </div>
                                            {% if userPermissionSite.edit is defined and userPermissionSite.edit == true %}
                                                <div class="col-sm-4 text-right font-weight-bold">
                                                    <a href="{{ path('site_edit', {id:lease.site.id}) }}">Edit Site Details</a>
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="form-group row">
                                            <div class="col-md-6">
                                                <label>Site ID</label>
                                                <input type="text" class="form-control" disabled value="{{ lease.site.number }}">
                                            </div>
                                            <div class="col-md-6">
                                                <label>Site Name</label>
                                                <input type="text" class="form-control" disabled value="{{ lease.site.name }}">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>Site Address</label>
                                            <input type="text" class="form-control" disabled value="{{ lease.site.address }}">
                                        </div>
                                        <div class="form-group row">
                                            <div class="col-sm-12">
                                                <div id="googleMap" style="width:100%;height:300px;"></div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label>Site Status</label>
                                            <select name="site[siteStatus]" class="form-control">
                                                {% for siteStatus in siteStatuses %}
                                                    <option value="{{ siteStatus.id }}" {{ (lease.site.siteStatus is defined and lease.site.siteStatus.id is defined and lease.site.siteStatus.id == siteStatus.id) ? 'selected' : '' }}>
                                                        {{ siteStatus.name }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label>Landlord</label>
                                            <select name="lease[landlord]" id="kt_select2__landlord" class="form-control kt-select2" style="width: 100%;">
                                                <option></option>
                                                {% for landlord in landlords %}
                                                    <option value="{{ landlord.id }}" {{ (lease.landlord is defined and lease.landlord.id is defined and lease.landlord.id == landlord.id) ? 'selected' : '' }}>{{ landlord.name }}</option>
                                                {% endfor %}
                                            </select>
                                            <a href="{{ path('landlord_add') }}" class="pull-right">Add Landlord</a>
                                            <div class="invalid-feedback">This field is required.</div>
                                        </div>
                                        <div class="form-group">
                                            <label>Lease Type</label>
                                            <select name="lease[type][]" multiple id="kt_select2__type" class="form-control kt-select2" style="width: 100%;">
                                                <option></option>
                                                {% for leaseType in leaseTypes %}
                                                    <option value="{{ leaseType.id }}">{{ leaseType.name }}</option>
                                                {% endfor %}
                                            </select>
                                            <div class="invalid-feedback">This field is required.</div>
                                        </div>
                                        <div class="form-group">
                                            <label>SQM of Leased premises</label>
                                            <input type="text" class="form-control" name="lease[sqm]" placeholder="SQM of Leased premises" value="{{ lease.sqm }}">
                                        </div>
                                        <div class="form-group">
                                            <label>Commencement Date</label>
                                            <div class="input-group date">
                                                <input type="text" class="form-control" name="lease[startDate]"  id="lease_startDate"  value="{{ (lease.startDate is defined and lease.startDate is not empty) ? lease.startDate|date('d M Y') : '' }}" readonly placeholder="Select date"/>
                                                <div class="input-group-append">
                                                        <span class="input-group-text">
                                                            <i class="la la-calendar-o"></i>
                                                        </span>
                                                </div>
                                                <div class="invalid-feedback">This field is required.</div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>Expiry Date</label>
                                            <div class="input-group date" >
                                                <input type="text" class="form-control" name="lease[endDate]"  id="lease_endDate"  value="{{ (lease.endDate is defined and lease.endDate is not empty) ? lease.endDate|date('d M Y') : '' }}" readonly placeholder="Select date"/>
                                                <div class="input-group-append">
                                                        <span class="input-group-text">
                                                            <i class="la la-calendar-o"></i>
                                                        </span>
                                                </div>
                                                <div id="endDate-error" class="invalid-feedback">Must be greater than Commencement Date.</div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>Lease Term</label>
                                            <input type="number" class="form-control" readonly name="lease[term]" placeholder="Enter number of months" value="{{ lease.term }}">
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-sm-6 col-form-label">Renewal Option in lease</label>
                                            <div class="col-sm-6">
                                                    <span class="kt-switch">
                                                        <label>
                                                            <input type="checkbox" name="lease[renewalStatus]" id="leaseRenewalStatus" {{ (lease.renewalStatus is defined and lease.renewalStatus == true) ? 'checked' : '' }}/>
                                                            <span></span>
                                                        </label>
                                                    </span>
                                            </div>
                                            <div class="col-sm-12" id="leaseRenewalOptional" style="{{ (lease.renewalStatus is defined and lease.renewalStatus == true) ? '' : 'display: none;' }}">
                                                <select name="lease[renewal]" class="form-control" id="leaseRenewal">
                                                    <option value="">Select number of days</option>
                                                    <option value="30" {{ (lease.renewal is defined and lease.renewal == 30) ? 'selected' : '' }}>30 days</option>
                                                    <option value="60" {{ (lease.renewal is defined and lease.renewal == 60) ? 'selected' : '' }}>60 days</option>
                                                    <option value="90" {{ (lease.renewal is defined and lease.renewal == 90) ? 'selected' : '' }}>90 days</option>
                                                    <option value="180" {{ (lease.renewal is defined and lease.renewal == 180) ? 'selected' : '' }}>180 days</option>
                                                    <option value="360" {{ (lease.renewal is defined and lease.renewal == 360) ? 'selected' : '' }}>360 days</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-sm-6 col-form-label">Termination Clause in lease</label>
                                            <div class="col-sm-6">
                                                    <span class="kt-switch">
                                                        <label>
                                                            <input type="checkbox" name="lease[terminationClauseStatus]" id="leaseTerminationClauseStatus" {{ (lease.terminationClauseStatus is defined and lease.terminationClauseStatus == true) ? 'checked' : '' }}/>
                                                            <span></span>
                                                        </label>
                                                    </span>
                                            </div>
                                            <div class="col-sm-12" id="terminationClauseOptional" style="{{ (lease.terminationClauseStatus is defined and lease.terminationClauseStatus == true) ? '' : 'display: none;' }}">
                                                <select name="lease[terminationClause]" id="leaseTerminationClause" class="form-control">
                                                    <option value="">Select number of days</option>
                                                    <option value="30" {{ (lease.terminationClause is defined and lease.terminationClause == 30) ? 'selected' : '' }}>30 days</option>
                                                    <option value="60" {{ (lease.terminationClause is defined and lease.terminationClause == 60) ? 'selected' : '' }}>60 days</option>
                                                    <option value="90" {{ (lease.terminationClause is defined and lease.terminationClause == 90) ? 'selected' : '' }}>90 days</option>
                                                    <option value="180" {{ (lease.terminationClause is defined and lease.terminationClause == 180) ? 'selected' : '' }}>180 days</option>
                                                    <option value="360" {{ (lease.terminationClause is defined and lease.terminationClause == 360) ? 'selected' : '' }}>360 days</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="kt-section">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <h3 class="kt-section__title">Lease Notes</h3>
                                        </div>
                                    </div>
                                    <div class="kt-section__content">
                                        <div class="kt-form__body">
                                            <div class="kt-section kt-section--first">
                                                <div class="kt-section__body">
                                                    <div class="notes-items">
                                                        {% for note in leaseNotes %}
                                                            <div class="notes-item mb-3">
                                                                <input type="hidden" name="notes[{{ loop.index }}][id]" value="{{ note.id }}">
                                                                <div class="form-group mb-2">
                                                                    <textarea class="form-control" name="notes[{{ loop.index }}][text]" placeholder="Type notes...">{{ note.text }}</textarea>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-sm-6">
                                                                        <label class="btn-label">
                                                                            Date of note:
                                                                            <span class="font-weight-bold">{{ note.updated|date('d M Y H:i') }}</span>
                                                                        </label>
                                                                    </div>
                                                                    {% if userPermission.edit is defined and userPermission.edit == true %}
                                                                        <div class="col-sm-6 text-right">
                                                                            <button type="button" class="btn btn-danger btn-sm removeNotes">Remove Notes</button>
                                                                        </div>
                                                                    {% endif %}
                                                                </div>
                                                            </div>
                                                        {% endfor %}
                                                    </div>
                                                    {% if userPermission.edit is defined and userPermission.edit == true %}
                                                        <div class="col-12 text-center">
                                                            <button type="button" class="btn btn-success btn-sm" id="btnAddNotes">Add Notes</button>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="kt-separator kt-separator--space-lg kt-separator--fit kt-separator--border-solid"></div>
                            <div class="kt-form__actions">
                                <div class="row">
                                    {% if userPermission.edit is defined and userPermission.edit == true %}
                                        <div class="col-sm-12 text-right">
                                            <button name="submit_step_1" type="submit" class="btn btn-success">Save</button>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </form>
                    </div>
                    <!--End:: Tab Content-->

                    <!--Begin:: Tab Content-->
                    <div class="tab-pane" id="leaseCommercials" role="tabpanel">
                        <div class="kt-section">
                            <div class="row">
                                <div class="col-sm-8">
                                    <h3 class="kt-section__title">Lease Commercials</h3>
                                </div>
                                {% if userPermission.edit is defined and userPermission.edit == true %}
                                    <div class="col-sm-4 text-right mobile-buttons-container__left">
                                        <button class="btn btn-primary btn-sm" id="openModalAddAddendum"><i class="fa fa-plus"></i> Add Addendum</button>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="kt-section__content">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="tableRentalCost">
                                        <thead>
                                            <tr>
                                                <th width="45%"></th>
                                                <th width="15%">Initial Rental</th>
                                                <th width="15%">Start Date</th>
                                                <th width="15%">Current Rental</th>
                                                <th width="10%" class="text-center">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% set initialTotal = 0 %}
                                            {% set initialCurrentTotal = 0 %}
                                            {% for rentalCost in leaseRentalCosts %}
                                                {% if rentalCost.additional == false %}
                                                    {% set currentAmount = rentalCost.amount %}
                                                    {% if date(rentalCost.startDate) <= date() %}
                                                        {% set currentAmount = rentalCost.currentAmount %}
                                                        {% set initialTotal = initialTotal + rentalCost.amount|round(2) %}
                                                        {% set initialCurrentTotal = initialCurrentTotal + currentAmount %}
                                                    {% endif %}

                                                    <tr data-id="{{ rentalCost.id }}" data-initial="1">
                                                        <td data-category-id="{{ rentalCost.category.id }}">{{ rentalCost.category.name }}</td>
                                                        <td>{{ currencySymbol }} {{ rentalCost.amount }}</td>
                                                        <td>{{ rentalCost.startDate|date('d M Y') }}</td>
                                                        <td>{{ currencySymbol }} {{ currentAmount }}</td>
                                                        <td class="text-center">
                                                            {% if userPermission.edit is defined and userPermission.edit == true %}
                                                                <a href="#" class="btn btn-clean btn-sm btn-icon btn-icon-sm editAddendumBtn">
                                                                    <i class="fa fa-pencil-alt"></i>
                                                                </a>
                                                                <a href="#" class="btn btn-clean btn-sm btn-icon btn-icon-sm removeAddendumBtn">
                                                                    <i class="text-danger fa fa-times"></i>
                                                                </a>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                {% endif %}
                                            {% endfor %}
                                            <tr>
                                                <td class="font-weight-bold">INITIAL MONTHLY LEASE COST</td>
                                                <td class="font-weight-bold">{{ currencySymbol }} <span id="initialTotal">{{ initialTotal|round(2) }}</span></td>
                                                <td></td>
                                                <td class="font-weight-bold">{{ currencySymbol }} <span id="initialCurrentTotal">{{ initialCurrentTotal|round(2) }}</span></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td class="font-weight-bold">ADDITIONAL EQUIPMENT ADDENDUM</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            {% set monthlyTotal = initialTotal %}
                                            {% set monthlyCurrentTotal = initialCurrentTotal %}
                                            {% for rentalCost in leaseRentalCosts %}
                                                {% if rentalCost.additional == true %}
                                                    {% set currentAmount = rentalCost.amount %}
                                                    {% if date(rentalCost.startDate) <= date() %}
                                                        {% set currentAmount = rentalCost.currentAmount %}
                                                        {% set monthlyTotal = monthlyTotal + rentalCost.amount|round(2) %}
                                                        {% set monthlyCurrentTotal = monthlyCurrentTotal + currentAmount %}
                                                    {% endif %}
                                                    <tr data-id="{{ rentalCost.id }}">
                                                        <td data-category-id="{{ rentalCost.category.id }}">{{ rentalCost.category.name }}</td>
                                                        <td>{{ currencySymbol }} {{ rentalCost.amount }}</td>
                                                        <td>{{ rentalCost.startDate|date('d M Y') }}</td>
                                                        <td>{{ currencySymbol }} {{ currentAmount }}</td>
                                                        <td>
                                                            {% if userPermission.edit is defined and userPermission.edit == true %}
                                                                <a href="#" class="btn btn-clean btn-sm btn-icon btn-icon-sm editAddendumBtn">
                                                                    <i class="fa fa-pencil-alt"></i>
                                                                </a>
                                                                <a href="#" class="btn btn-clean btn-sm btn-icon btn-icon-sm removeAddendumBtn">
                                                                    <i class="text-danger fa fa-times"></i>
                                                                </a>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                {% endif %}
                                            {% endfor %}
                                            <tr id="totalMonthlyRentalCostTR">
                                                <td class="font-weight-bold">TOTAL MONTHLY RENT COST</td>
                                                <td class="font-weight-bold">{{ currencySymbol }} <span id="monthlyTotal">{{ monthlyTotal|round(2) }}</td>
                                                <td class="font-weight-bold"></td>
                                                <td class="font-weight-bold">{{ currencySymbol }} <span id="monthlyCurrentTotal">{{ monthlyCurrentTotal|round(2) }}</span></td>
                                                <td></td>
                                            </tr>
                                            {% if lease.electricityType.id == 3 %}
                                                <tr>
                                                    <td>Electricity (Landlord - Fixed)</td>
                                                    <td>{{ currencySymbol }} {{ lease.electricityFixed }}</td>
                                                    <td>{{ lease.startDate|date('d M Y') }}</td>
                                                    <td>{{ currencySymbol }} {{ lease.electricityFixed+((lease.electricityFixed*percentage)/100)|round(2) }}</td>
                                                    <td></td>
                                                </tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                                <div class="kt-separator kt-separator--space-lg kt-separator--fit kt-separator--border-solid"></div>
                                <form class="kt-form" action="{{ path('lease_edit', {id:lease.id}) }}" method="post" id="formStep2">
                                    <div class="kt-form__body">
                                        <div class="kt-section kt-section--first">
                                            <div class="kt-section__body">
                                                <div class="form-group">
                                                    <label>Electricity</label>
                                                    <select name="lease[electricityType]" id="electricityTypeSelect" class="form-control">
                                                        <option value="">Select Electricity</option>
                                                        {% for electricityType in electricityTypes %}
                                                            <option value="{{ electricityType.id }}" {{ (lease.electricityType is defined and lease.electricityType.id is defined and lease.electricityType.id == electricityType.id) ? 'selected' : '' }}>{{ electricityType.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                                <div class="form-group" id="electricityFixedInput" style="{{ (lease.electricityType is defined and lease.electricityType.id is defined and lease.electricityType.id == 3) ? '' : 'display: none;' }}">
                                                    <label>Electricity Fixed Amount</label>
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><span class="input-group-text">{{ currencySymbol }}</span></div>
                                                        <input type="number" class="form-control" name="lease[electricityFixed]" placeholder="Electricity Fixed Amount" value="{{ lease.electricityFixed }}">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label>Other Utility Costs</label>
                                                    <select name="lease[otherUtilityCost][]" multiple id="kt_select2_otherUtilityCost" class="form-control kt-select2" style="width: 100%;">
                                                        <option></option>
                                                        {% for otherUtilityCostCategory in otherUtilityCostCategories %}
                                                            <option value="{{ otherUtilityCostCategory.id }}">{{ otherUtilityCostCategory.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                    <div class="invalid-feedback">This field is required.</div>
                                                </div>
                                                <div class="form-group">
                                                    <label>Frequency of lease payments</label>
                                                    <select name="lease[frequencyOfLeasePayments]" class="form-control">
                                                        <option value="">Select a Frequency of lease payments</option>
                                                        <option value="monthly" {{ (lease.frequencyOfLeasePayments is defined and lease.frequencyOfLeasePayments == 'monthly') ? 'selected' : '' }}>Monthly</option>
                                                        <option value="annually" {{ (lease.frequencyOfLeasePayments is defined and lease.frequencyOfLeasePayments == 'annually') ? 'selected' : '' }}>Annually</option>
                                                    </select>
                                                </div>
                                                <div class="row">
                                                    <div class="col-sm-12">
                                                        <h3 class="kt-section__title kt-section__title-sm">Escalation</h3>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label>Annual Escalation Type</label>
                                                    <select name="lease[annualEscalationType]" class="form-control" id="annualEscalationTypeSelect">
                                                        <option value="">Select Annual Escalation Type</option>
                                                        <option value="percentage" {{ (lease.annualEscalationType is defined and lease.annualEscalationType == 'percentage') ? 'selected' : '' }}>Fixed Percentage</option>
                                                        <option value="cpi" {{ (lease.annualEscalationType is defined and lease.annualEscalationType == 'cpi') ? 'selected' : '' }}>CPI Linked</option>
                                                    </select>
                                                </div>
                                                <div class="form-group" id="annualEscalationFixed" style="{{ (lease.annualEscalationType is defined and lease.annualEscalationType != 'percentage') ? 'display: none;' : '' }}">
                                                    <label>Annual Escalation %</label>
                                                    <input type="number" class="form-control" name="lease[annualEscalation]" id="annualEscalationFixedInput" value="{{ lease.annualEscalation }}" placeholder="Annual Escalation %" >
                                                </div>
                                                <div class="form-group" id="annualEscalationCpi" style="{{ (lease.annualEscalationType is defined and lease.annualEscalationType == 'cpi') ? '' : 'display: none;' }}">
                                                    <label>Annual Escalation %</label>
                                                    <select class="form-control" name="lease[annualEscalationCpi]" id="annualEscalationCpiSelect">
                                                        <option value="">CPI plus x%</option>
                                                        <option value="0.5" {{ (lease.annualEscalationCpi == 0.5) ? 'selected' : '' }}>CPI plus 0.5%</option>
                                                        <option value="1" {{ (lease.annualEscalationCpi == 1) ? 'selected' : '' }}>CPI plus 1%</option>
                                                        <option value="1.5" {{ (lease.annualEscalationCpi == 1.5) ? 'selected' : '' }}>CPI plus 1.5%</option>
                                                        <option value="2" {{ (lease.annualEscalationCpi == 2) ? 'selected' : '' }}>CPI plus 2%</option>
                                                        <option value="2.5" {{ (lease.annualEscalationCpi == 2.5) ? 'selected' : '' }}>CPI plus 2.5%</option>
                                                        <option value="3" {{ (lease.annualEscalationCpi == 3) ? 'selected' : '' }}>CPI plus 3%</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label>First escalation month</label>
                                                    <select name="lease[annualEscalationDate]" class="form-control">
                                                        <option value="">Select a First escalation month</option>
                                                        <option value="12month" {{ (lease.annualEscalationDate is defined and lease.annualEscalationDate == '12month') ? 'selected' : '' }}>12 months from start of lease</option>
                                                        <option value="1" {{ (lease.annualEscalationDate is defined and lease.annualEscalationDate == 1) ? 'selected' : '' }}>January</option>
                                                        <option value="2" {{ (lease.annualEscalationDate is defined and lease.annualEscalationDate == 2) ? 'selected' : '' }}>February</option>
                                                        <option value="3" {{ (lease.annualEscalationDate is defined and lease.annualEscalationDate == 3) ? 'selected' : '' }}>March</option>
                                                        <option value="4" {{ (lease.annualEscalationDate is defined and lease.annualEscalationDate == 4) ? 'selected' : '' }}>April</option>
                                                        <option value="5" {{ (lease.annualEscalationDate is defined and lease.annualEscalationDate == 5) ? 'selected' : '' }}>May</option>
                                                        <option value="6" {{ (lease.annualEscalationDate is defined and lease.annualEscalationDate == 6) ? 'selected' : '' }}>June</option>
                                                        <option value="7" {{ (lease.annualEscalationDate is defined and lease.annualEscalationDate == 7) ? 'selected' : '' }}>July</option>
                                                        <option value="8" {{ (lease.annualEscalationDate is defined and lease.annualEscalationDate == 8) ? 'selected' : '' }}>August</option>
                                                        <option value="9" {{ (lease.annualEscalationDate is defined and lease.annualEscalationDate == 9) ? 'selected' : '' }}>September</option>
                                                        <option value="10" {{ (lease.annualEscalationDate is defined and lease.annualEscalationDate == 10) ? 'selected' : '' }}>October</option>
                                                        <option value="11" {{ (lease.annualEscalationDate is defined and lease.annualEscalationDate == 11) ? 'selected' : '' }}>November</option>
                                                        <option value="12" {{ (lease.annualEscalationDate is defined and lease.annualEscalationDate is same as('12')) ? 'selected' : '' }}>December</option>
                                                    </select>
                                                </div>
                                                <div class="row">
                                                    <div class="col-sm-12">
                                                        <h3 class="kt-section__title kt-section__title-sm">Deposit</h3>
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label class="col-sm-6 col-form-label">Deposit Payable</label>
                                                    <div class="col-sm-6">
                                                <span class="kt-switch">
                                                    <label>
                                                        <input type="checkbox" name="lease[depositStatus]" id="leaseDepositStatus" {{ (lease.depositStatus is defined and lease.depositStatus == true) ? 'checked' : '' }}/>
                                                        <span></span>
                                                    </label>
                                                </span>
                                                    </div>
                                                </div>
                                                <div class="deposit-fields" style="{{ (lease.depositStatus is defined and lease.depositStatus == true) ? '' : 'display:none;' }}">
                                                    <div class="form-group">
                                                        <label>Deposit Type</label>
                                                        <select name="lease[depositType]" class="form-control">
                                                            <option value="">Select Deposit Type</option>
                                                            {% for depositType in depositTypes %}
                                                                <option value="{{ depositType.id }}" {{ (lease.depositType is defined and lease.depositType.id is defined and lease.depositType.id == depositType.id) ? 'selected' : '' }}>{{ depositType.name }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Deposit Amount</label>
                                                        <div class="input-group">
                                                            <div class="input-group-prepend"><span class="input-group-text">{{ currencySymbol }}</span></div>
                                                            <input type="number" class="form-control" name="lease[depositAmount]" id="depositAmountValue" placeholder="Deposit Amount" value="{{ lease.depositAmount }}">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="kt-separator kt-separator--space-lg kt-separator--fit kt-separator--border-solid"></div>
                                    <div class="kt-form__actions">
                                        <div class="row">
                                            {% if userPermission.edit is defined and userPermission.edit == true %}
                                                <div class="col-sm-12 text-right">
                                                    <button name="submit_step_2" type="submit" class="btn btn-success">Save</button>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <!--End:: Tab Content-->

                    <!--Begin:: Tab Content-->
                    <div class="tab-pane" id="leaseDocuments" role="tabpanel">
                        <form class="kt-form" action="{{ path('lease_edit', {id:lease.id}) }}" method="post" id="formStep4" enctype="multipart/form-data">
                            <div class="kt-form__body">
                                <div class="kt-section kt-section--first">
                                    <div class="kt-section__body">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <h3 class="kt-section__title">Lease Supporting Documents</h3>
                                            </div>
                                        </div>
                                        <div class="document-items">
                                            {% if leaseDocuments is defined and leaseDocuments is not empty %}
                                                {% for leaseDocument in leaseDocuments %}
                                                    <div class="document-item">
                                                        <input type="hidden" value="{{ leaseDocument.id }}" name="document[{{ loop.index }}][id]">
                                                        <div class="form-group">
                                                            <label>Type</label>
                                                            <select name="document[{{ loop.index }}][type]" class="form-control">
                                                                <option value="">Select a Document Type</option>
                                                                {% for documentType in documentsTypes %}
                                                                    <option value="{{ documentType.id }}" {{ (leaseDocument.type is defined and leaseDocument.type.id is defined and leaseDocument.type.id == documentType.id) ? 'selected' : '' }}>
                                                                        {{ documentType.name }}
                                                                    </option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                        <div class="form-group row">
                                                            <label class="col-12 col-form-label">Upload File:</label>
                                                            <div class="col-12">
                                                                <div class="upload-file-container {{ (leaseDocument.document is defined and leaseDocument.document is not empty) ? 'uploaded' : '' }}">
                                                                    <input type="hidden" name="document[{{ loop.index }}][name]" value="{{ leaseDocument.name }}">
                                                                    <input type="hidden" class="upload-file-container__fake-upload" name="document[{{ loop.index }}][document]" value="{{ leaseDocument.document }}">
                                                                    <input  type="file" name="document[{{ loop.index }}][document]" hidden="hidden" class="documentInput upload-file-container__custom-upload">
                                                                    <button class="upload-file-container__upload-button btn btn-sm btn-info">
                                                                        <i class="fas fa-plus-circle"></i>
                                                                        <span>Choose a file</span>
                                                                    </button>
                                                                    <div class="upload-file-container__file-uploaded">
                                                                        <div class="upload-file-container__close">
                                                                            <i class="fa fa-times"></i>
                                                                        </div>
                                                                        <i class="fas fa-cloud-download-alt"></i>
                                                                        <span class="upload-file-container__file-name">
                                                                        <a href="{{ leaseDocument.document }}" target="_blank">{{ (leaseDocument.name is defined and leaseDocument.name is not empty) ? leaseDocument.name : '' }}</a>
                                                                    </span>
                                                                        <span class="upload-file-container__file-date">
                                                                        {{ (leaseDocument.created is defined and leaseDocument.created is not empty) ? leaseDocument.created|date('d M Y') : '' }}
                                                                    </span>
                                                                    </div>
                                                                    <div class="text-danger" style="display: none;">This field is required.</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        {% if userPermission.edit is defined and userPermission.edit == true %}
                                                            <div class="col-12 text-right">
                                                                <button type="button" class="btn btn-danger btn-sm removeDocument">Remove Document</button>
                                                            </div>
                                                        {% endif %}
                                                        <hr>
                                                    </div>
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                        {% if userPermission.edit is defined and userPermission.edit == true %}
                                            <div class="row">
                                                <div class="col-12 text-center">
                                                    <button type="button" class="btn btn-info" id="addDocument">Add Supporting Document</button>
                                                </div>
                                            </div>
                                        {% endif %}
                                        <hr>
                                        <div class="form-group">
                                            <label>Status Of Lease Documentation</label>
                                            <select name="lease[documentStatus]" class="form-control">
                                                <option value="">Select a Status Of Lease Documentation</option>
                                                {% for documentStatus in documentsStatuses %}
                                                    <option value="{{ documentStatus.id }}" {{ (lease.documentStatus is defined and lease.documentStatus.id is defined and lease.documentStatus.id == documentStatus.id) ? 'selected' : '' }}>{{ documentStatus.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="kt-separator kt-separator--space-lg kt-separator--fit kt-separator--border-solid"></div>
                            <div class="kt-form__actions">
                                <div class="row">
                                    {% if userPermission.edit is defined and userPermission.edit == true %}
                                        <div class="col-sm-12 text-right">
                                            <button name="submit_step_4" type="submit" class="btn btn-success">Save</button>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </form>
                    </div>
                    <!--End:: Tab Content-->
                    {% if userPermissionIssue.view is defined and userPermissionIssue.view == true %}
                        <!--Begin:: Tab Content-->
                        <div class="tab-pane" id="issueTab" role="tabpanel">
                            <div class="kt-section">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <h3 class="kt-section__title">Site Issue</h3>
                                    </div>
                                </div>
                                <ul class="nav nav-tabs nav-tabs-space-lg nav-tabs-line nav-tabs-bold nav-tabs-line-2x nav-tabs-line-brand" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" data-toggle="tab" href="#openIssue" role="tab">Open</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-toggle="tab" href="#closeIssue" role="tab">Close</a>
                                    </li>
                                </ul>
                                <div class="tab-content mt-4">
                                    <div class="tab-pane active" id="openIssue" role="tabpanel">
                                        <div class="kt-section__content">
                                            <table class="table table-striped- table-bordered table-hover table-checkable responsive no-wrap" id="tableIssueOpen">
                                                <thead>
                                                <tr>
                                                    <th>Date logged</th>
                                                    <th>Type</th>
                                                    <th>Details</th>
                                                    <th></th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                {% if openIssues is defined and openIssues is not empty %}
                                                    {% for openIssue in openIssues %}
                                                        <tr data-id="{{ openIssue.id }}">
                                                            <td>{{ openIssue.logged|date('d M Y H:i') }}</td>
                                                            <td>{{ (openIssue.type.name is defined) ? openIssue.type.name : openIssue.type }}</td>
                                                            <td>{{ openIssue.details }}</td>
                                                            <td class="text-center">
                                                                {% if openIssue.status == true and userPermissionIssue.edit is defined and userPermissionIssue.edit == true %}
                                                                    <a href="#" class="btn btn-sm btn-success doneIssueBtn"><i class="fa fa-check"></i> Done</a>
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                {% endif %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="closeIssue" role="tabpanel">
                                        <div class="kt-section__content">
                                            <table class="table table-striped- table-bordered table-hover table-checkable responsive no-wrap" id="tableIssueClose">
                                                <thead>
                                                <tr>
                                                    <th>Date logged</th>
                                                    <th>Type</th>
                                                    <th>Details</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                {% if closeIssues is defined and closeIssues is not empty %}
                                                    {% for closeIssue in closeIssues %}
                                                        <tr data-id="{{ closeIssue.id }}">
                                                            <td>{{ closeIssue.logged|date('d M Y H:i') }}</td>
                                                            <td>{{ (closeIssue.type.name is defined) ? closeIssue.type.name : closeIssue.type }}</td>
                                                            <td>{{ closeIssue.details }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                {% endif %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--End:: Tab Content-->
                    {% endif %}
                    <!--Begin:: Tab Content-->
                    <div class="tab-pane" id="siteInventoryAndEmergency" role="tabpanel">
                        <div class="kt-section">
                            <div class="row">
                                <div class="col-sm-12">
                                    <h3 class="kt-section__title">Site Inventory</h3>
                                </div>
                            </div>
                            <div class="kt-section__content">
                                <form class="kt-form kt-form--label-right" action="{{ path('lease_edit', {id:lease.id}) }}" method="post" id="formStep6Inventory">
                                    <div class="kt-form__body">
                                        <div class="kt-section kt-section--first">
                                            <div class="kt-section__body">
                                                <div id="siteInventoryItems">
                                                    {% for siteInventory in siteInventories %}
                                                        <div class="site-inventory-item">
                                                            <input type="hidden" value="{{ siteInventory.id }}" name="siteInventory[{{ loop.index }}][id]">
                                                            <div class="form-group row">
                                                                <label class="col-2 col-form-label">Category</label>
                                                                <div class="col-10">
                                                                    <select class="form-control" name="siteInventory[{{ loop.index }}][category]">
                                                                        <option value="">Select a Inventory Category</option>
                                                                        {% for siteInventoryCategory in siteInventoryCategories %}
                                                                            <option value="{{ siteInventoryCategory.id }}" {{ (siteInventory.category is defined and siteInventory.category.id is defined and siteInventory.category.id == siteInventoryCategory.id) ? 'selected' : '' }}>
                                                                                {{ siteInventoryCategory.name }}
                                                                            </option>
                                                                        {% endfor %}
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label class="col-2 col-form-label">Quantity</label>
                                                                <div class="col-10">
                                                                    <input type="number" name="siteInventory[{{ loop.index }}][quantity]" value="{{ siteInventory.quantity }}" class="form-control siteInventoryQuantity" placeholder="Quantity">
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label class="col-2 col-form-label">Size</label>
                                                                <div class="col-10">
                                                                    <input type="number" name="siteInventory[{{ loop.index }}][size]" step="0.01" value="{{ siteInventory.size }}" class="form-control siteInventorySize" placeholder="Size (mm)">

                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label class="col-2 col-form-label">Height</label>
                                                                <div class="col-10">
                                                                    <input type="number" name="siteInventory[{{ loop.index }}][height]" step="0.01" value="{{ siteInventory.height }}" class="form-control siteInventoryHeight" placeholder="Height (m)">
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label class="col-2 col-form-label">Weight</label>
                                                                <div class="col-10">
                                                                    <input type="number" name="siteInventory[{{ loop.index }}][weight]" step="0.01" value="{{ siteInventory.weight }}" class="form-control siteInventoryWeight" placeholder="Weight (kg)">
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label class="col-2 col-form-label">Additional info</label>
                                                                <div class="col-10">
                                                                    <textarea class="form-control" name="siteInventory[{{ loop.index }}][info]" rows="3" placeholder="Additional info">{{ siteInventory.info }}</textarea>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label class="col-2 col-form-label">Last Updated:</label>
                                                                <label class="col-10 col-form-label font-weight-bold text-left">
                                                                    {% if siteInventory.updated is not empty %}
                                                                        {{ siteInventory.updated|date('d M Y H:i') }}
                                                                    {% else %}
                                                                        {{ lease.site.updated|date('d M Y H:i') }}
                                                                    {% endif %}
                                                                </label>
                                                            </div>
                                                            {% if userPermission.edit is defined and userPermission.edit == true %}
                                                                <div class="col-12 text-right">
                                                                    <button type="button" class="btn btn-danger btn-sm removeSiteInventory">Remove Site Inventory</button>
                                                                </div>
                                                            {% endif %}
                                                            <hr>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                                {% if userPermission.edit is defined and userPermission.edit == true %}
                                                    <div class="col-12 text-center">
                                                        <button type="button" class="btn btn-info btn-sm" id="addSiteInventory">Add Site Inventory</button>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="kt-separator kt-separator--space-lg kt-separator--fit kt-separator--border-solid"></div>
                                    <div class="kt-form__actions">
                                        <div class="row">
                                            {% if userPermission.edit is defined and userPermission.edit == true %}
                                                <div class="col-sm-12 text-right">
                                                    <button name="submit_step_6_inventory" type="submit" class="btn btn-success">Save</button>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="kt-separator kt-separator--space-lg kt-separator--fit kt-separator--border-solid"></div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <h3 class="kt-section__title">Site Emergency Access Details</h3>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <h3 class="kt-section__title kt-section__title-sm">Emergency Access Details</h3>
                                </div>
                            </div>
                            <div class="kt-section__content">
                                <form class="kt-form kt-form--label-right" action="{{ path('lease_edit', {id:lease.id}) }}" method="post" id="formStep6EmergencyAccess">
                                    <div class="kt-form__body">
                                        <div class="kt-section kt-section--first">
                                            <div class="kt-section__body">
                                                <div class="form-group">
                                                    <label>Hours of access</label>
                                                    <select class="form-control" name="site[hoursOfAccess]">
                                                        <option value="">Select Hours of Access</option>
                                                        {% for hoursOfAccessType in hoursOfAccessTypes %}
                                                            <option value="{{ hoursOfAccessType.id }}" {{ (lease.site.hoursOfAccess is defined and lease.site.hoursOfAccess.id is defined and lease.site.hoursOfAccess.id == hoursOfAccessType.id) ? 'selected' : '' }}>
                                                                {{ hoursOfAccessType.name }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label>Other access information and procedures</label>
                                                    <textarea class="form-control" name="site[otherAccess]" rows="3" placeholder="Other access information and procedures">{{ lease.site.otherAccess }}</textarea>
                                                </div>
                                                <div class="form-group">
                                                    <label>Last Updated</label>
                                                    <div class="input-group date" >
                                                        <input type="text" class="form-control" disabled name="site[emergencyAccessUpdated]"  id="site_emergencyAccessUpdated"  value="{{ (lease.site.emergencyAccessUpdated is defined and lease.site.emergencyAccessUpdated is not empty) ? lease.site.emergencyAccessUpdated|date('d M Y') : '' }}" readonly placeholder="Select date"/>
                                                        <div class="input-group-append">
                                                            <span class="input-group-text">
                                                                <i class="la la-calendar-o"></i>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="kt-checkbox-inline mt-2">
                                                        <label class="kt-checkbox kt-checkbox--bold kt-checkbox--brand">
                                                            <input type="checkbox" id="emergencyAccessUpdatedManually" name="emergencyAccessUpdatedManually" value="on">
                                                            Edit manually
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <h3 class="kt-section__title kt-section__title-sm mt-2">Emergency Access Contacts</h3>
                                        </div>
                                        {% if userPermission.edit is defined and userPermission.edit == true %}
                                            <div class="col-6 text-right">
                                                <button type="button" class="btn btn-success btn-sm" data-toggle="modal" data-target="#modalAddContact">Add Contact</button>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="kt-form__body">
                                        <div class="kt-section">
                                            <div class="kt-section__body">
                                                <div class="form-group">
                                                    <label>Primary Emergency Contact</label>
                                                    <select class="form-control" id="selectPrimaryEmergencyContact" name="site[primaryEmergencyContact]" required>
                                                        <option value="">Select a Primary Emergency Contact</option>
                                                        {% for landlordContact in landlordContacts %}
                                                            <option value="{{ landlordContact.id }}"
                                                                    {{ (lease.site.primaryEmergencyContact.id is defined and lease.site.primaryEmergencyContact.id == landlordContact.id) ? 'selected' : '' }}>
                                                                {{ landlordContact.firstName~' '~landlordContact.lastName }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label>Secondary Emergency Contact</label>
                                                    <select class="form-control"  id="selectSecondaryEmergencyContact" name="site[secondaryEmergencyContact]">
                                                        <option value="">Select a Secondary Emergency Contact</option>
                                                        {% for landlordContact in landlordContacts %}
                                                            <option value="{{ landlordContact.id }}"
                                                                    {{ (lease.site.secondaryEmergencyContact.id is defined and lease.site.secondaryEmergencyContact.id == landlordContact.id) ? 'selected' : '' }}>
                                                                {{ landlordContact.firstName~' '~landlordContact.lastName }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="kt-separator kt-separator--space-lg kt-separator--fit kt-separator--border-solid"></div>
                                    <div class="kt-form__actions">
                                        <div class="row">
                                            {% if userPermission.edit is defined and userPermission.edit == true %}
                                                <div class="col-sm-12 text-right">
                                                    <button name="submit_step_6_emergency_access" type="submit" class="btn btn-success">Save</button>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </form>
                            </div>

                        </div>
                    </div>
                    <!--End:: Tab Content-->

                    <!--Begin:: Tab Content-->
                    <div class="tab-pane" id="leasePrevious" role="tabpanel">
                        <div class="kt-section">
                            <div class="row">
                                <div class="col-sm-12">
                                    <h3 class="kt-section__title">Previous Lease Details</h3>
                                </div>
                            </div>
                            <div class="kt-section__content">
                                <div class="kt-form__body">
                                    <div class="kt-section kt-section--first">
                                        <div class="kt-section__body">
                                            {% if previousLeases is not empty %}
                                                <div class="kt-form kt-form--label-right">
                                                    <div class="kt-portlet__body">
                                                        {% for previousLease in previousLeases %}
                                                            {% if loop.index0 != 0 %}
                                                                <div class="kt-separator kt-separator--space-md kt-separator--fit kt-separator--border-solid"></div>
                                                            {% endif %}
                                                                <div class="form-group form-group-xs row">
                                                                    <div class="col-sm-6">
                                                                    <span class="form-control-plaintext">
                                                                        Start Date:
                                                                        <span class="kt-font-bolder">
                                                                            {{ previousLease.startDate|date('d M Y') }}
                                                                        </span>
                                                                    </span>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <span class="form-control-plaintext">
                                                                            End Date:
                                                                            <span class="kt-font-bolder">
                                                                                {{ previousLease.endDate|date('d M Y') }}
                                                                            </span>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group form-group-xs row">
                                                                    <div class="col-sm-6">
                                                                        <span class="form-control-plaintext">
                                                                            Lease Renewal Option:
                                                                            <span class="kt-font-bolder">
                                                                                {{ (previousLease.renewalStatus == true) ? 'Yes' : 'No' }}
                                                                            </span>
                                                                        </span>
                                                                    </div>
                                                                    {% if previousLease.renewalStatus == true %}
                                                                        <div class="col-sm-6">
                                                                            <span class="form-control-plaintext">
                                                                                Lease Renewal Option Period:
                                                                                <span class="kt-font-bolder">
                                                                                    {{ previousLease.renewal }} {{ (previousLease.renewal == 1) ? 'month' : 'months' }}
                                                                                </span>
                                                                            </span>
                                                                        </div>
                                                                    {% endif %}
                                                                </div>
                                                                <div class="form-group form-group-xs row">
                                                                    <div class="col-sm-12">
                                                                        <span class="form-control-plaintext">
                                                                            Escalation:
                                                                            <span class="kt-font-bolder">
                                                                                {% if previousLease.annualEscalationType == 'cpi' %}
                                                                                    CPI plus {{ previousLease.annualEscalationCpi }}%
                                                                                {% else %}
                                                                                    Fixed {{ previousLease.annualEscalation }}%
                                                                                {% endif %}
                                                                            </span>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group form-group-xs row">
                                                                    <div class="col-sm-6">
                                                                        <span class="form-control-plaintext">
                                                                            Electricity:
                                                                            <span class="kt-font-bolder">
                                                                                {{ previousLease.electricityType.name }}
                                                                            </span>
                                                                        </span>
                                                                    </div>
                                                                    {% if previousLease.electricityType.id == 3 %}
                                                                        <div class="col-sm-6">
                                                                            <span class="form-control-plaintext">
                                                                                Electricity Amount:
                                                                                <span class="kt-font-bolder">
                                                                                    {{ currencySymbol }} {{ previousLease.electricityFixed }}
                                                                                </span>
                                                                            </span>
                                                                        </div>
                                                                    {% endif %}
                                                                </div>

                                                                {% set valueWater = 'No' %}
                                                                {% set valueSewer = 'No' %}
                                                                {% set valueRates = 'No' %}
                                                                {% set valueRefuse = 'No' %}
                                                                {% if previousLease.otherUtilityCost is not empty %}
                                                                    {% for otherCost in previousLease.otherUtilityCost %}
                                                                        {% if otherCost.name == 'Water' %}
                                                                            {% set valueWater = 'Yes' %}
                                                                        {% elseif otherCost.name == 'Sewer' %}
                                                                            {% set valueSewer = 'Yes' %}
                                                                        {% elseif otherCost.name == 'Rates' %}
                                                                            {% set valueRates = 'Yes' %}
                                                                        {% elseif otherCost.name == 'Refuse' %}
                                                                            {% set valueRefuse = 'Yes' %}
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                {% endif %}
                                                                <div class="form-group form-group-xs row">
                                                                    <div class="col-sm-6">
                                                                        <span class="form-control-plaintext">
                                                                            Water:
                                                                            <span class="kt-font-bolder">
                                                                                {{ valueWater }}
                                                                            </span>
                                                                        </span>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <span class="form-control-plaintext">
                                                                            Sewer:
                                                                            <span class="kt-font-bolder">
                                                                                {{ valueSewer }}
                                                                            </span>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group form-group-xs row">
                                                                    <div class="col-sm-6">
                                                                        <span class="form-control-plaintext">
                                                                            Rates:
                                                                            <span class="kt-font-bolder">
                                                                                {{ valueRates }}
                                                                            </span>
                                                                        </span>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <span class="form-control-plaintext">
                                                                            Refuse:
                                                                            <span class="kt-font-bolder">
                                                                                {{ valueRefuse }}
                                                                            </span>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <h3 class="kt-section__title kt-section__title-sm mb-0">Lease Supporting Documents</h3>
                                                                <div class="form-group form-group-xs row">
                                                                    <div class="col-sm-12">
                                                                        <span class="form-control-plaintext">
                                                                            Status Of Lease Documentation:
                                                                            <span class="kt-font-bolder">
                                                                                {{ (previousLease.documentStatus.name is defined) ? previousLease.documentStatus.name : '' }}
                                                                            </span>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="document-items">
                                                                    {% if previousLease.leaseDocuments is defined and previousLease.leaseDocuments is not empty %}
                                                                        <div class="form-group row">
                                                                            {% for previousLeaseDocument in previousLease.leaseDocuments %}
                                                                                <div class="col-xl-3 col-md-4 col-sm-6 col-12 mt-2">
                                                                                    <div class="upload-file-container uploaded bg-light">
                                                                                        <a href="{{ previousLeaseDocument.document }}" target="_blank">
                                                                                            <div class="upload-file-container__file-uploaded">
                                                                                                <span class="text-dark font-weight-bold">
                                                                                                    {{ (previousLeaseDocument.type.name is defined) ? previousLeaseDocument.type.name : '' }}
                                                                                                </span>
                                                                                                <span class="upload-file-container__file-name">
                                                                                                   {{ (previousLeaseDocument.name is defined and previousLeaseDocument.name is not empty) ? previousLeaseDocument.name : '' }}
                                                                                                </span>
                                                                                                <span class="upload-file-container__file-date">
                                                                                                    {{ (previousLeaseDocument.created is defined and previousLeaseDocument.created is not empty) ? previousLeaseDocument.created|date('d M Y') : '' }}
                                                                                                </span>
                                                                                            </div>
                                                                                        </a>
                                                                                    </div>
                                                                                </div>
                                                                            {% endfor %}
                                                                        </div>
                                                                    {% endif %}
                                                                </div>
                                                                <h3 class="kt-section__title kt-section__title-sm mb-2">Lease Commercials</h3>
                                                                <div class="table-responsive">
                                                                    <table class="table table-bordered responsive">
                                                                        <tbody>
                                                                            <tr>
                                                                                <td class="font-weight-bold">FROM</td>
                                                                                {% for headerFrom in previousLease.commercials.from %}
                                                                                    <td>{{ headerFrom|date('d M Y') }}</td>
                                                                                {% endfor %}
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="font-weight-bold">TO</td>
                                                                                {% for headerTo in previousLease.commercials.to %}
                                                                                    <td>{{ headerTo|date('d M Y') }}</td>
                                                                                {% endfor %}
                                                                            </tr>
                                                                            {% for item in previousLease.commercials.items %}
                                                                                <tr>
                                                                                    <td class="font-weight-bold" colspan="{{ item.skip }}">{{ item.name }}</td>
                                                                                    {% for amount in item.amount %}
                                                                                        {% if amount is not null %}
                                                                                            <td>{{ currencySymbol }} {{ amount|round(2) }}</td>
                                                                                        {% endif %}
                                                                                    {% endfor %}
                                                                                </tr>
                                                                            {% endfor %}

                                                                            <tr>
                                                                                <td class="font-weight-bold">Total Monthly Rent</td>
                                                                                {% for totalMonthly in previousLease.commercials.totalMonthly %}
                                                                                    <td class="font-weight-bold">{{ currencySymbol }} {{ totalMonthly|round(2) }}</td>
                                                                                {% endfor %}
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="font-weight-bold">Total Annual Rent</td>
                                                                                {% for totalAnnual in previousLease.commercials.totalAnnual %}
                                                                                    <td class="font-weight-bold">{{ currencySymbol }} {{ totalAnnual|round(2) }}</td>
                                                                                {% endfor %}
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                                <div class="form-group text-right mb-0">
                                                                    <a href="{{ path('lease_edit', {id:previousLease.id}) }}" class="btn btn-info">Edit Lease</a>
                                                                </div>
                                                        {% endfor %}
                                                    </div>
                                                </div>
                                            {% else %}
                                                <h5 class="text-center">Previous leases not found.</h5>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--End:: Tab Content-->
                </div>
            </div>
        </div>

    </div>

    <div class="modal fade show" id="modalAddAddendum" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Addendum</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <form method="post" action="{{ path('lease_add_addendum', {id:lease.id}) }}" id="formAddAddendum">
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Rental Costs Category</label>
                            <select name="category" id="leaseRentalCost_category" class="form-control kt-select2" style="width: 100%;">
                                <option></option>
                                {% for rentalCostCategory in rentalCostCategories %}
                                    <option value="{{ rentalCostCategory.id }}">{{ rentalCostCategory.name }}</option>
                                {% endfor %}
                            </select>
                            <div class="invalid-feedback">This field is required.</div>
                        </div>
                        <div class="form-group">
                            <label>Amount</label>
                            <div class="input-group">
                                <div class="input-group-prepend"><span class="input-group-text">{{ currencySymbol }}</span></div>
                                <input type="number" class="form-control" id="leaseRentalCost_amount" name="amount" placeholder="Rental Amount" value="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Starting Date</label>
                            <div class="input-group date">
                                <input type="text" class="form-control" name="startDate"  id="leaseRentalCost_startDate"  value="" readonly placeholder="Select date"/>
                                <div class="input-group-append">
                                    <span class="input-group-text"><i class="la la-calendar-o"></i></span>
                                </div>
                                <div class="invalid-feedback">This field is required.</div>
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Add</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade show" id="modalEditAddendum" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Addendum</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <form method="post" id="formEditAddendum">
                    <input type="hidden" id="formEditAddendum_Id" value="">
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Rental Costs Category</label>
                            <select name="category" id="leaseRentalCostEdit_category" class="form-control kt-select2" style="width: 100%;">
                                <option></option>
                                {% for rentalCostCategory in rentalCostCategories %}
                                    <option value="{{ rentalCostCategory.id }}">{{ rentalCostCategory.name }}</option>
                                {% endfor %}
                            </select>
                            <div class="invalid-feedback">This field is required.</div>
                        </div>
                        <div class="form-group">
                            <label>Amount</label>
                            <div class="input-group">
                                <div class="input-group-prepend"><span class="input-group-text">{{ currencySymbol }}</span></div>
                                <input type="number" class="form-control" id="leaseRentalCostEdit_amount" name="amount" placeholder="Rental Amount" value="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Starting Date</label>
                            <div class="input-group date">
                                <input type="text" class="form-control" name="startDate"  id="leaseRentalCostEdit_startDate"  value="" readonly placeholder="Select date"/>
                                <div class="input-group-append">
                                    <span class="input-group-text"><i class="la la-calendar-o"></i></span>
                                </div>
                                <div class="invalid-feedback">This field is required.</div>
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Edit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade show" id="modalAddContact" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Add Contact</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="formCreateContact" method="post" action="{{ path('contact_create') }}">
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Landlord:</label>
                            <select class="form-control" name="landlord">
                                <option value="">Select a Landlord</option>
                                {% for landlord in landlords %}
                                    <option value="{{ landlord.id }}">{{ landlord.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Type</label>
                            <select name="type" id="selectContactType" class="form-control kt-select2" style="width: 100%;">
                                <option></option>
                                {% for contactType in landlordContactTypes %}
                                    <option value="{{ contactType.id }}">{{ contactType.name }}</option>
                                {% endfor %}
                            </select>
                            <div class="invalid-feedback">This field is required.</div>
                        </div>
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" class="form-control" name="firstName" placeholder="Name">
                        </div>
                        <div class="form-group">
                            <label>Surname</label>
                            <input type="text" class="form-control" name="lastName" placeholder="Surname" >
                        </div>
                        <div class="form-group">
                            <label>Company</label>
                            <input type="text" class="form-control" name="company" placeholder="Company">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="text" class="form-control" name="email" placeholder="Email">
                        </div>
                        <div class="form-group">
                            <label>Mobile</label>
                            <input type="tel" class="form-control" name="mobile" placeholder="Mobile">
                        </div>
                        <div class="form-group">
                            <label>Landline</label>
                            <input type="tel" class="form-control" name="landline" placeholder="Landline">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" id="btnCreateContact">Create</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('assets/vendors/general/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/vendors/general/select2/dist/js/select2.full.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/vendors/general/jquery-form/dist/jquery.form.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/vendors/general/jquery-validation/dist/jquery.validate.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/vendors/custom/js/vendors/jquery-validation.init.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/vendors/general/bootstrap-switch/dist/js/bootstrap-switch.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/vendors/custom/js/vendors/bootstrap-switch.init.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/vendors/custom/datatables/datatables.bundle.js') }}" type="text/javascript"></script>

    <script>
        var leaseTypeValue = [];
        {% for type in lease.type %}
            leaseTypeValue.push('{{ type.id }}')
        {% endfor %}

        var otherUtilityCostValue = [];
        {% for cost in lease.otherUtilityCost %}
            otherUtilityCostValue.push('{{ cost.id }}')
        {% endfor %}

        var documentTypes = [];
        {% for documentType in documentsTypes %}
            documentTypes.push({
                id: '{{ documentType.id }}',
                name: '{{ documentType.name }}',
            });
        {% endfor %}
        var documentIndex = {{ leaseDocuments|length }};

        var percentage = {{ percentage }};

        var siteInventoryCategories = [];
        {% for siteInventoryCategory in siteInventoryCategories %}
            siteInventoryCategories.push({
                id: '{{ siteInventoryCategory.id }}',
                name: '{{ siteInventoryCategory.name }}',
            });
        {% endfor %}
        var siteInventoryIndex = {{ siteInventories|length }};

        var notesIndex = {{ leaseNotes|length }};

        var currencySymbol = '{{ currencySymbol }}';
    </script>

    <script src="{{ asset('assets/js/pages/lease_edit.js') }}" type="text/javascript"></script>

    <script>
        var geocoder;
        var map;
        var address = '{{ lease.site.address }}';
        function initMap() {
            var map = new google.maps.Map(document.getElementById('googleMap'), {
                zoom: 15,
                center: {lat: -34.397, lng: 150.644}
            });
            geocoder = new google.maps.Geocoder();
            codeAddress(geocoder, map);
        }

        function codeAddress(geocoder, map) {
            geocoder.geocode({'address': address}, function(results, status) {
                if (status === 'OK') {
                    map.setCenter(results[0].geometry.location);
                    var marker = new google.maps.Marker({
                        map: map,
                        position: results[0].geometry.location
                    });
                }
            });
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCliFm7C1H1t_O5MFiN-SB3luq867neo4Y&libraries=places&callback=initMap" async defer></script>
{% endblock %}
